## Please make sure that index is made last, since making the parts will ensure that meta data about file locations is generated.

all-parts:
	cd man; make
	cd syntax; make
	cd bindings; make
	cd states; make
	cd dynamic; make
	cd types; make
	cd state-types; make
	cd tutorial; make
	cd extensions; make
	cd index; make

SSIFLAGS=-dEXAMPLES=$(EXDIR) -dEXAMPLES_OUTPUT=$(EXOUTDIR) -dBASE=$(HREF_BASE) $(MORE_SSIFLAGS)
SSI=$(SSIDIR)/ssipp

$(POSTPROCDIR)/html: $(POSTPROCDIR)/html.l
	cd $(POSTPROCDIR); make
$(POSTPROCDIR)/man: $(POSTPROCDIR)/man.l
	cd $(POSTPROCDIR); make
$(SSI): $(SSIDIR)/main.cc $(SSIDIR)/ssiyylex.ll $(SSIDIR)/ssiscanner.h $(SSIDIR)/ssiscanner.cc
	cd $(SSIDIR); make

SAXON=@SAXON@

build/%.xml: %.sxml build/%.depend ../formats/html.xsl $(SSI)
	cat $< | $(SSI) $(SSIFLAGS) > $@

.PHONY: clean
clean:
	-rm $(PRODUCTS)

.PRECIOUS: build/*.depend
build/%.depend: %.sxml $(wildcard *.sxml) $(SSI)
	cat $*.sxml | $(SSI) $(SSIFLAGS) --head build/$*.xml --deps > $@
