\documentclass[noamsthm,handout]{beamer}
% ,handout,notes=onlyslideswithnotes

\usepackage[center]{tiddemath}
\usepackage{tiddetext}
\usepackage{tiddedae}
\usepackage{parskip}

\usepackage[utf-8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{textcomp}

%\usepackage{beamerthemesplit}
\usetheme{JuanLesPins}

\usepackage{verbatim}

\title{Shapes}
\subtitle{--- ett hyfsat funktionellt ritspråk}
\author{Henrik Tidefelt}
\institute{LiTH}
\date{\today}

\newcommand{\inEnglish}[1]{(eng: \emph{#1})}

\newcommand{\maincoveringmode}{invisible}
\usepackage[swedish]{babel}

\providecommand{\paragraph}[1]{\textbf{#1}\,}

\newcounter{tmppauses}

\begin{document}

% svenska är förvalt, men det här visar hur man skulle gjort för att byta till det andra språket:
\selectlanguage{swedish}

\frame{%
\note[item]{Hälsa alla välkomna!}%
\note[item]{Presentera mig.}
\note[item]{Mycket hellre frågor under tiden än efteråt.}
\titlepage}

\section*{Översikt}
\frame{\frametitle{Mål}
  Med den här UppLYSningen hoppas jag
  \pause
  \begin{itemize}[<+->]
  \item Att ni ska få ett hum om vad \Shapes är.
  \item Få höra era invändningar mot designen som den ser ut idag.
  \item Lyckas hitta någon testpilot.
  \item Väcka intresse för utvecklingssamarbete.
  \end{itemize}
  \note[item]{Inget att säga här.}
}

\frame{\frametitle{Plan}
  De stora inslagen idag är:
  \pause
  \begin{itemize}[<+->]
  \item Beskriva hur språkets struktur ser ut idag.
  \item Visa lite av de funktioner som kärnan erbjuder.
  \item Diskutera intressanta utmaningar för framtiden.
  \end{itemize}
  \note[item]{Påminn om att man gärna får ställa frågor!}
}

\setbeamercovered{\maincoveringmode}

\section{Introduktion}
\frame{%
  \begin{center}
    {\Huge Introduktion}
  \end{center}
  \note{Då börjar vi\ldots}
}

\frame{\frametitle{Historia}
  \begin{itemize}[<+->]
  \item Hösten 2003: Första kontakt med MetaPost.
  \item Sommaren 2004: Toolbox för plottning i \Matlab tar form.
  \item Hösten 2004: Börjar undersöka möjligheten att ersätta MetaPost.
  \item September 2005: Shapes, då kallat \emph{MetaPDF}, versionshanteras.
  \item Januari 2007: Shapes, då kallat \emph{Drool}, har använts till stort antal figurer i en bok.
  \item April 2007: Kontrollerade tillstånd.
  \item September 2007: Språket heter \emph{Shapes}, och presenteras för första gången.
  \end{itemize}
  \note[item]{Inget att säga här.}
}
\frame{\frametitle{Rötter}
  \Shapes har sina rötter i många av de språk jag varit i kontakt med:
  \begin{itemize}[<+->]
  \item MetaPost (en omarbetning av Knuths MetaFont) --- \Shapes kom till när jag ledsnade på MetaPost.
  \item Scheme --- syntax och funktions-begreppet.
  \item Haskell --- för sina rena ideal.
  \item C++ --- utmatningssyntaxen.
  \end{itemize}
  \note[item]{Inget att säga här.}
}
\frame{\frametitle{Alternativ}
  Några andra ritspråk som finns och/eller används idag:
  \begin{itemize}[<+->]
  \item MetaPost
  \item Asymptote
  \item PGF och TikZ
  \item Haskell~PDF
  \end{itemize}
  \note[item]{Inget att säga här.}
}
\frame{\frametitle{Varför \Shapes?}
  Givet utbudet av alternativa rit-språk, varför utveckla ett till?  Här är några skäl:
  \begin{itemize}[<+->]
  \item Inte funktionellt orienterade (alla utom Haskell~PDF).
  \item Dålig beräkningskapacitet (MetaPost och PDF/TikZ).
  \item Saknar domän-specifik syntax (Haskell~PDF).
  \item Inte publicerade när \Shapes påbörjades (Asymptote och Haskell~PDF).
  \end{itemize}
  \note[item]{Inget att säga här.}
}

\begin{frame}[fragile]
  \frametitle{Hello, shaper!}

\texttt{%
$\bullet$page <{}< [stroke (0cm,0cm)-{}-(1cm,1cm)]
}

\pause

\texttt{%
$\bullet$page <{}< stroke [] ((0cm,0cm)-{}-(1cm,1cm))
}

\pause

\texttt{%
[($\backslash$ $\bullet$dst pth .> \{ $\bullet$dst <{}< stroke [] pth \} )\\
\ \ $\bullet$page \ (0cm,0cm)-{}-(1cm,1cm)]
}

  \note[item]{Kör live-demo!}
\end{frame}

\section{Språkets struktur}
\frame{%
  \begin{center}
    {\Huge Språkets struktur}
  \end{center}
  \note[item]{Det här är kanske inte den roligaste biten av presentationen för den som är intresserad av grafik.}
}

\subsection{Enkla typer}
\begin{frame}[fragile]\frametitle{Exempel på enkla typer}
  \begin{itemize}
  \item Flyttal: \texttt{14}, \texttt{14.5}, \texttt{~1}
  \item Heltal: \texttt{'5}, \texttt{'$\sim$12}, \texttt{'0xFF}
  \item Längd: \texttt{7cm}, \texttt{$\sim$3mm}, \texttt{72bp}
  \item Sträng (mer detaljer senare): \texttt{\textasciigrave{}Hej!\textasciiacute{}}
  \item Symbol: \texttt{'left}
  \end{itemize}
  \note[item]{Inget att säga här.}
\end{frame}

\subsection{Bindningar och scopes}
\frame{\frametitle{Lexikala bindningar}
  Lexikala bindningar fungerar som i Scheme, men kan inte bindas om.

  \texttt{%
    a: 42
  }

  \pause
  
  Räckvidden \inEnglish{scope} är begränsad till en kod-klammer \inEnglish{code bracket}:

  \texttt{%
    \{\\
    \ \ a: 42\\
    \ \ $\bullet$stdout <{}< a\\
    \}\\
  }

  \note[item]{Inget att säga här.}
}
\frame{\frametitle{Lexikala bindningar --- detaljer}
  
  \begin{itemize}
  \item Högerledet evalueras i samma scope som bindningen tillhör.  (Jämför \texttt{letrec} i Scheme.)\\
    \texttt{%
      odd:  $\backslash$ n .> [if n = '0  false [even n - '1]]\\
      even: $\backslash$ n .> [if n = '0  true  [odd  n - '1]]
    }
  \item Skuggade bindningar kan nås:\\
    \texttt{%
      a: ../a + 7
    }
    \note[item]{Tillgång till skuggade bindningar kräver förståelse av vilka konstruktioner som inför en kod-klammer.}
  \end{itemize}

  \note[item]{Inget att säga här.}
}
\frame{\frametitle{Dynamiska bindningar}
  Dynamisk bindning infördes som ett sätt att undvika den imperativa spagetti-struktur som ett skrivbart \emph{graphics state} lätt kan leda till.

  \texttt{%
    @width:4bp | [stroke mypath]
  }
  
  \begin{itemize}
  \item Dynamiska variabler inleds med \texttt{@}.
  \item Den dynamiska variabeln tillsammans med ett värde blir ett nytt värde som representerar en potentiell dynamisk bindning.
    \note[item]{Förslag på bätte språkbruk?}
  \item Bindningsvärden kan kombineras:\\
    \texttt{%
      @width:4bp \& @dash:[dashpattern 1cm 4mm]
    }
  \item Dynamiska bindningar sätts i scope med en ``pipe''.
  \item En dynamisk variabel har ett filter och ett skönsvärde \inEnglish{default value}.
  \end{itemize}
}
\begin{frame}\frametitle{Dynamiska värden}
  En dynamisk variabel kan bindas till ett \emph{dynamiskt värde}.
  \begin{itemize}
  \item Ser ut så här:\\
    \texttt{%
      @bigmargin: {\color{red}dynamic} 1.3 * @smallmargin
    }
  \item Undviker behovet av att binda alla dynamiska variabler till argumentlösa funktioner.
  \end{itemize}
\end{frame}
\subsection{Funktionsanrop}
\frame{\frametitle{Funktionsdefinitioner}
  Exempel:

  \texttt{%
    {\color{red}$\backslash$} x y {\color{red}.>} x * x + y * y
  }

  \pause
  \begin{itemize}
  \item Argumentens namn är en del av funktionens signatur.
  \item En slask \inEnglish{sink} kan ta hand om ytterligare argument.\\
    \texttt{%
      $\backslash$ x y {\color{red}<>} rest .> x + y + (foo [] <>rest)
    }
  \item Vilka argument som helst kan få skönsvärden:\\
  \texttt{%
    $\backslash$ x{\color{red}:}3 y z{\color{red}:}2 .> x + y + z
  }
  \end{itemize}
  \note[item]{Inget att säga här.}
}
\begin{frame}\frametitle{Enkla funktionsanrop}
  Ett enkelt funktionsanrop kan ange argument både genom ordning och genom namn.
  
  \texttt{%
    hypot: $\backslash$ x y .> [sqrt x*x + y*y]
  }

  \begin{itemize}
  \item Ordnade argument: se anrop till \texttt{sqrt}.
  \item Namngivna argument: \texttt{[hypot y:3 x:4]}.
  \item Blandat: Ordnade argument måste komma först.
  \item Endast ett argument: \texttt{square [] 3} eller \texttt{square [] x:3}
  \end{itemize}
  
  Märk att namngivna argument kan inte ändra betydelsen av ordnade argument!
\end{frame}
\begin{frame}\frametitle{Snitt}
  Scheme: \emph{evaluated cuts}

  \texttt{%
    [hypot 3 ...]
  }
  \\
  \texttt{%
    [hypot y:4 ...]
  }

  \begin{itemize}
  \item Ordnade argument blir helt osynliga i den nya funktionen.
  \item Namngivna argument (er)sätter skönsvärden.
  \item Endast ett argument: \texttt{hypot [...] 3} eller \texttt{hypot [...] y:4}
  \end{itemize}
  
\end{frame}
\subsection{Kontrollerade tillstånd}
\begin{frame}\frametitle{Scenario}
  Utgångsbudet för att skapa en komplex bild i ett funktionellt språk är att skriva ett stort uttryck som sätter ihop de ingående delarna till en helhet.

  \begin{itemize}
  \item Det skapar lätt en krystad struktur i koden.
  \item Det stämmer illa med \emph{painter's model} och hur de flesta av oss tänker på att skapa en bild.
  \item Intuitionen är snarare \emph{imperativ}!
  \item \ldots men variabler kunde ju inte bindas om\ldots
  \end{itemize}

  \note[item]{Inget att säga här.}
\end{frame}
\begin{frame}\frametitle{Kontrollerade tillstånd}
  \Shapes erbjuder \emph{kontrollerade tillstånd} \inEnglish{limited states} för att tillåta en viss grad av imperativ stil.

  \begin{itemize}
  \item Kontrollerade tillstånd binds till variabler som inleds med $\bullet$ eller $\#$: \texttt{$\bullet$page}
  \item De kan skickas \emph{by reference} till ``funktioner'', men kan inte returneras.
    \note[item]{Att returnera en automatisk variabel by reference är inte bra.}
  \item Några finns globalt, andra kan skapas genom avknoppning från speciella \emph{värden}.
  \end{itemize}

\end{frame}
\begin{frame}\frametitle{Grundläggande operationer}
  Det finns tre huvudsakliga operationer på ett tillstånd:
  \begin{itemize}
  \item
    Lägga till \inEnglish{tack on}: \texttt{$\bullet$dst {\color{red}<{}<{}} pic}
  \item
    Frysa \inEnglish{freeze}, erhålla slutgiltigt värde, och förstöra: \texttt{$\bullet$dst{\color{red};}}
    \note[item]{Används både för att frigöra resurser, och för att tydliggöra i koden att tillståndet är ute ur spelet.}
  \item
    Tjuvtitta \inEnglish{peek}, bör ge samma resultat som att frysa, men förstör inte tillståndet: \texttt{{\color{red}(}$\bullet$dst{\color{red})}}
  \end{itemize}
  
\end{frame}

\begin{frame}\frametitle{Exempel~1}
\texttt{%
mark: $\backslash$ {\color{red}$\bullet$}dst .>\\
\{\\
\ \ {\color{red}$\bullet$}dst {\color{red}<{}<{}} [stroke (0cm,0cm)-{}-(1cm,1cm)]\\
\}\\
\ \\
{}[{}mark {\color{red}$\bullet$}page{}]{}\\
}
\end{frame}

\begin{frame}\frametitle{Exempel~2}
\texttt{%
$\bullet$page <{}<\\
{\color{red}\{}\\
\ \ $\bullet$dst: {\color{red}newGroup2D}\\
\ \ $\bullet$dst <{}<{} house <{}<{} car\\
\ \ \ \ <{}<{} dog\\
\ \ $\bullet$dst <{}<{} cow\\
\ \ $\bullet$dst;\\
{\color{red}\}}
}

\texttt{%
$\bullet$page <{}< {\color{red}(} newGroup2D <{}< sun <{}< clouds {\color{red})}\\
}
\end{frame}

\begin{frame}\frametitle{Mer om tillstånd}
  \begin{itemize}
  \item Inbyggda tillstånds-avknoppare:\\
    \texttt{newIgnore}, \texttt{newGroup2D}, \texttt{newGroup3D}, \texttt{newString}, \texttt{newTimer}, \texttt{newText}, \texttt{newFont}, \texttt{newZBuf}, \texttt{newZSorter}
  \item Högre-nivå-konstruktorer:\\
    \texttt{newRandom}, \texttt{devRandom}
  \item Globalt definierade (interaktion med omvärlden) tillstånd:\\
    \texttt{$\bullet$page}, \texttt{$\bullet$catalog}, \texttt{$\bullet$stdout}, \texttt{$\bullet$stderr}, \texttt{$\bullet$randomdevice}, \texttt{$\bullet$time}, \texttt{$\bullet$ignore}
  \end{itemize}
\end{frame}

\begin{frame}\frametitle{``Funktioner'' och tillstånd\ldots}
  \begin{itemize}
  \item Tillstånd kan skickas både ordnat och per namn, precis som argument.
  \item En funktion kommer inte åt tillstånd utanför sin kropp.
  \item Anrop bör ses som makro-expansion snarare än funktions-anrop.
  \item En kod-klammer med tillstånd blir ett \emph{uttryck}; utifrån syns det inte att tillstånd används för att konstruera klammerns värde.
  \item Ett tillstånd kan endast frysas i sin egen kod-klammer, så en funktion kan inte frysa tillstånd som den tar emot.
  \item Tillstånds-parametrar kan inte ges skönsvärden.
  \item Ett rent funktionsanrop kan inte påverka några tillstånd!
  \end{itemize}
\end{frame}

\begin{frame}\frametitle{Procedurer}
  En \emph{procedur} kan påverka tillstånd utanför sin egen kropp.

  \begin{itemize}
  \item Kan vara praktiskt ibland.
  \item Svårt att analysera.
  \item Att användas under kontrollerade former.
  \item Skapas med egen syntax:\\
    \texttt{proc: {\color{red}$\backslash$} arg1 arg2 {\color{red}.> !} body}
  \item Anropas med egen syntax (annars skulle det se ut som ett rent uttryck!):\\
    \texttt{{\color{red}[!}proc arg1 arg2{\color{red}]}}
  \end{itemize}
\end{frame}

\begin{frame}\frametitle{Utmaning}
  Dynamiska tillstånd\ldots
\end{frame}

\subsection{Structures}
\frame{\frametitle{Structures}
  \note[item]{Inget att säga här.}
}
\subsection{Evaluering}
\frame{\frametitle{Lat evaluering}
  \note[item]{Inget att säga här.}
}
\frame{\frametitle{Continuation passing style}
  \note[item]{Inget att säga här.}
}


\section{Funktioner i kärnan}
\frame{%
  \begin{center}
    {\Huge Funktioner i kärnan}
  \end{center}
  \note[item]{Inget att säga här.}
}

\frame{\frametitle{Kurv-konstruktion}
  \note[item]{Inget att säga här.}
}
\frame{\frametitle{Travare (\emph{sliders})}
  \begin{itemize}
  \item Skapa utifrån kurvlängd, kurvtid, eller andra beräkningar
  \item Punktvisa egenskaper för kurvan
  \item Del-kurvor
  \end{itemize}
  \note[item]{Inget att säga här.}
}
\frame{\frametitle{Grundläggande ritning}
  \note[item]{Inget att säga här.}
}
\frame{\frametitle{Travare}
  \note[item]{Inget att säga här.}
}
\frame{\frametitle{2D}
  \note[item]{Inget att säga här.}
}
\frame{\frametitle{3D}
  \note[item]{Inget att säga här.}
}
\frame{\frametitle{PDF}
  \note[item]{Inget att säga här.}
}
\frame{\frametitle{\LaTeX{} och strängar}
  \note[item]{Inget att säga här.}
}

\section{Utmaningar för framtiden}
\frame{%
  \begin{center}
    {\Huge Utmaningar för framtiden}
  \end{center}
  \note[item]{Inget att säga här.}
}

\frame{\frametitle{Trixelering}
  \note[item]{Inget att säga här.}
}
\frame{\frametitle{Kompilera funktioner till PDF}
  \note[item]{Inget att säga här.}
}
\frame{\frametitle{Mer grund-struktur}
  \begin{itemize}
  \item Namespaces/packages
  \item Användar-typer
  \end{itemize}
  \note[item]{Inget att säga här.}
}

\section{Sammanfattning}
\frame{%
  \begin{center}
    {\Huge Sammanfattning}
  \end{center}
  \note[item]{Inget att säga här.}
}
\frame{\frametitle{Sammanfattning}
  \begin{itemize}
    \item \Shapes är\ldots
  \end{itemize}
  \note[item]{Inget att säga här.}
}

\frame{%
  \begin{center}
    Slut.
  \end{center}
  \note[item]{Tacka för uppmärksamheten!}
}

\end{document}
